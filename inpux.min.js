class Inpux{constructor(e,t){this.setOptions(t),this.setInput(e),this.input&&(this.previousValue=this.input.value,this.input.value=this.val(),this.format(!0))}setOptions(e){var t,i,n,l,r,s,a,o,u,p,h,c,d,m,y,f,g,$,v,_,b,A,x,E,L,U,S,P,B,T;(e="object"==typeof e?e:{}).timePattern=null,e.datePattern=null,e.customPattern=null;let F;e.type=["NUMERAL","DATE","TIME","CUSTOM"].includes(F=String(t=e.type).toUpperCase())?F:"CUSTOM",e.onlyBlurred=!!(i=e.onlyBlurred)&&("string"==typeof i?/^(true|false)$/i.test(i):"boolean"==typeof i&&i),e.onlyFocused=!!(n=e.onlyFocused)&&("string"==typeof n?/^(true|false)$/i.test(n):"boolean"==typeof n&&n);let M,N,j,C,O,V,k,Z,R,D={NUMERAL:{type:e.type,onlyBlurred:e.onlyBlurred,onlyFocused:e.onlyFocused,emptyToZero:(l=e.emptyToZero)?"string"==typeof l?/^(true|false)$/i.test(l):"boolean"!=typeof l||l:"boolean"!=typeof l,decimalPlaces:!!(Y(r=e.decimalPlaces)&&Math.min(parseInt(r),100)>=0)&&Math.min(parseInt(r),100),numeralStyle:["THOUSAND","LAKH","WAN"].includes(M=String(s=e.numeralStyle).toUpperCase())?M:"THOUSAND",trailingZero:(a=e.trailingZero)?"string"==typeof a?/^(true|false)$/i.test(a):"boolean"!=typeof a||a:"boolean"!=typeof a,delimiters:(P=w(!!(o=e.delimiters)&&("string"==typeof o?o.split(""):!!Array.isArray(o)&&o)),B=[",","."],""===(P=0==(P=(P||B).slice(0,2).filter(e=>"string"==typeof e).map(e=>e.replace(/[0-9-]/g,"").charAt(0))).length?B:1==P.length?[P[0],P[0]]:P)[1]?[P[0],B[1]]:P),max:!!Y(u=e.max)&&W(u),min:!!Y(p=e.min)&&W(p)},CUSTOM:{type:e.type,onlyBlurred:e.onlyBlurred,onlyFocused:e.onlyFocused,pattern:function(t){if(!t||"string"!=typeof t)return!1;let i=(t=t.replace(/\X/g,"x")).split(/[^x]/).map(e=>e.length),n=t.replace(/\x/g,"").split("");return e.customPattern={blocks:i,delimiters:n},t}(e.pattern),blocks:function(t){var i,n,l;if(e.customPattern)return e.customPattern.blocks;let r=!!t&&((i=t,"number"==typeof i)?[t]:!!Array.isArray(t)&&t.length>0&&t);return!!r&&(l=(n=r,!!n&&n.map(e=>e?"number"==typeof e?parseInt(e):"string"==typeof e?isNaN(parseInt(e))?0:parseInt(e):0:0)),l.map(e=>Math.abs(e)))}(e.blocks),onlyNumbers:!!(h=e.onlyNumbers)&&("string"==typeof h?/^(true|false)$/i.test(h):"boolean"==typeof h&&h),leadingZero:(c=e.leadingZero)?"string"==typeof c?/^(true|false)$/i.test(c):"boolean"!=typeof c||c:"boolean"!=typeof c,delimiters:(T=e.delimiters,e.customPattern?w(e.customPattern.delimiters):w(!!T&&("string"==typeof T?T.split(""):!!Array.isArray(T)&&T))||[""]),contained:(d=e.contained,!!e.customPattern||!!d&&("string"==typeof d?/^(true|false)$/i.test(d):"boolean"==typeof d&&d)),max:Y(m=e.max)?[W(m)]:!!Array.isArray(m)&&G(m).length>0&&G(m),min:Y(y=e.min)?[W(y)]:!!Array.isArray(y)&&G(y).length>0&&G(y)},TIME:{contained:!0,onlyNumbers:!0,leadingZero:!0,type:e.type,onlyBlurred:e.onlyBlurred,onlyFocused:e.onlyFocused,pattern:function(t){let i=["H","M","S"],n="string"==typeof t?t.split(""):Array.isArray(t)?t:i,l=[];for(let r of n)l.includes(r)||l.includes(r.toUpperCase())||l.push(r);return n=l.filter(e=>i.includes(String(e).toUpperCase())),e.timePattern=n,n}(e.pattern),delimiters:w((f=e.delimiters)?"string"==typeof f?f.split(""):Array.isArray(f)?f:[":"]:[":"])||[":"],blocks:(g=e.timePattern).map(e=>2),max:($=e.timePattern,v=e.max,N={H:[0,23]},j=$.map(e=>N[e.toUpperCase()]||[0,59]),v=(v=Y(v)?[parseInt(v)]:Array.isArray(v)?v:[]).slice(0,j.length),j.map((e,t)=>v[t]?Math.min(Math.max(e[0],v[t]),e[1]):e[1])),min:(_=e.timePattern,b=e.min,C={H:[0,23]},O=_.map(e=>C[e.toUpperCase()]||[0,59]),b=(b=Y(b)?[parseInt(b)]:Array.isArray(b)?b:[]).slice(0,O.length),O.map((e,t)=>b[t]?Math.min(Math.max(e[0],b[t]),e[1]):e[0]))},DATE:{contained:!0,onlyNumbers:!0,leadingZero:!0,type:e.type,onlyBlurred:e.onlyBlurred,onlyFocused:e.onlyFocused,pattern:function(t){let i=["M","D","Y"],n="string"==typeof t?t.split(""):Array.isArray(t)?t:i,l=[];for(let r of n)l.includes(r)||l.includes(r.toUpperCase())||l.push(r);return n=l.filter(e=>i.includes(String(e).toUpperCase())),e.datePattern=n,n}(e.pattern),delimiters:w((A=e.delimiters)?"string"==typeof A?A.split(""):Array.isArray(A)?A:["/"]:["/"])||["/"],blocks:(x=e.datePattern).map(e=>"Y"===e?4:2),max:(E=e.datePattern,L=e.max,V={Y:[1,9999],M:[1,12]},k=E.map(e=>V[e.toUpperCase()]||[1,31]),L=(L=Y(L)?[parseInt(L)]:Array.isArray(L)?L:[]).slice(0,k.length),k.map((e,t)=>L[t]?Math.min(Math.max(e[0],parseInt(L[t])),e[1]):e[1])),min:(U=e.datePattern,S=e.min,Z={Y:[1,9999],M:[1,12]},R=U.map(e=>Z[e.toUpperCase()]||[1,31]),S=(S=Y(S)?[parseInt(S)]:Array.isArray(S)?S:[]).slice(0,R.length),R.map((e,t)=>S[t]?Math.min(Math.max(e[0],parseInt(S[t])),e[1]):e[0]))}},I=D[e.type];for(let H in I)!1===I[H]&&delete I[H];if(this.input){this.input.value=this.val(),this.options=I,this.adjustValue(),this.format(!0),this.previousValue=this.input.value;return}function W(e){return e?e.toLocaleString("en-US",{useGrouping:!1}):e}function Y(e){let t=W(e);return t=!!t&&t.replace(/[\.]/g,""),/^-?\d+$/.test(t)&&!isNaN(Number(e))}function G(e){return e.map(e=>{let t="number"==typeof e?Number.isInteger(e)?e:Math.floor(e):!!("string"==typeof e&&Y(e))&&e;return!!Y(t)&&W(t)})}function w(e){return!!e&&e.map(e=>e&&"string"==typeof e?e.charAt(0):"")}this.options=I}setInput(e){var t;(e=(t=e)?"string"==typeof t?document.querySelector(t):e instanceof HTMLInputElement?t:null:null)&&(e.addEventListener("input",this.handleInputEventListener),e.addEventListener("focus",this.handleFocusEventListener),e.addEventListener("blur",this.handleBlurEventListener),this.input&&(this.destroy(),this.input=e,this.input.value=this.val(),this.adjustValue(),this.format(!0),this.previousValue=this.input.value),this.input=e)}handleInputEventListener=e=>{if(this.options.onlyBlurred)this.input.value=this.val(),this.adjustValue();else{let t=this.input.value,i=this.input.selectionStart;this.input.value=this.val(),this.adjustValue(),this.format(),this.input.value==this.previousValue&&"deleteContentBackward"==e.inputType&&i--,this.previousValue=this.input.value;let n=i+(this.input.value.length-t.length);if(this.input.setSelectionRange)this.input.setSelectionRange(n,n);else if(this.input.createTextRange){let l=this.input.createTextRange();l.collapse(!0),l.moveEnd("character",n),l.moveStart("character",n),l.select()}}};handleBlurEventListener=()=>{this.input.value=this.val(),this.adjustValue(),this.format(!0),this.previousValue=this.input.value,this.options.onlyFocused&&(this.input.value=this.val())};handleFocusEventListener=()=>{this.options.onlyFocused&&(this.input.value=this.val(),this.adjustValue(),this.format(!0),this.previousValue=this.input.value),this.options.onlyBlurred&&(this.input.value=this.val())};format(e){let t=this.options,i=this.input.value,n=t.onlyNumbers,l=t.decimalPlaces,r=t.emptyToZero,s=t.trailingZero,a=t.leadingZero,o=t.delimiters,u=t.blocks,p=t.max,h=t.min,c=t.pattern,d="NUMERAL"===t.type,m="DATE"===t.type;i=d&&"-"==i&&e?"":i,i=String(n&&!u&&f(h)&&i.length>0&&e&&Number(i)<=Number(h)?h:i),i=String(n&&!u&&f(p)&&i.length>0&&e&&Number(i)>=Number(p)?p:i);let y=d?function i(n){var a,u;if(0===n.length){if(!r||!e)return[""];n=h&&Number(h)>0?h:"0"}let c=!e&&n.endsWith(`${o[1]}`)&&o[1]?o[1]:"",d={LAKH:/\B(?=(?:(\d\d)+(\d)(?!\d))+(?!\d))/g,THOUSAND:/\B(?=(\d{3})+(?!\d))/g,WAN:/\B(?=(\d{4})+(?!\d))/g}[t.numeralStyle.toUpperCase()],m=l&&e?Number(n.replace(o[1],".")).toFixed(l):Number(n.replace(o[1],"."));n=e?n.replace(/^(-?)0+(?=[\d])/g,"$1").replace(`-${o[1]}`,`-0${o[1]}`).replace(RegExp(`^\\${o[1]}`),`0${o[1]}`):n.replace(/^(-?)0+(?=[\d])/g,"$1"),n=m<=Number(h)&&e?h.replace(".",o[1]):n,n=m>=Number(p)&&e?p.replace(".",o[1]):n,0==m&&n.includes("-")&&e&&(n=n.replace("-",""));let y=n.split(o[1]);y[0]=y[0].replace(d,o[0]),y[1]=y[1]?o[1]+(e&&f(l)&&s?(a=y[1].slice(0,String(l)),u=l,a.length<u?a+"0".repeat(u-a.length):a):!e&&f(l)?y[1].slice(0,String(l)):y[1]):e&&f(l)&&s?`${o[1]}${"0".repeat(l)}`:"";let g=e?y.join("").replace(/^-0$/,"0"):y.join("");return g.startsWith(`${o[1]}`)&&e?["0"+g]:[g+c]}(i):t.blocks?function t(i){let l=[],r=0;for(;i.length>0;){let s=u[r%u.length],o=i.slice(0,s);if(n&&e){let d=!!Array.isArray(h)&&h[r%h.length],y=!!Array.isArray(p)&&p[r%p.length];o=String(f(d)&&Number(o)<=Number(d)?d:o),o=String(f(y)&&Number(o)>=Number(y)?y:o),o=a?g(o,s):o}o.length>=0&&(l.push(o),i=i.slice(s)),r++}if(m&&e){let $=c.indexOf("m")>-1?c.indexOf("m"):c.indexOf("M"),v=c.indexOf("d")>-1?c.indexOf("d"):c.indexOf("D"),_=[31,29,31,30,31,30,31,31,30,31,30,31][l[$]-1]||31;l[v]&&l[$]&&(l[v]=g(Math.min(l[v],_),2))}return l}(i):[i];function f(e){var t;let i=(t=e)?t.toLocaleString("en-US",{useGrouping:!1}):t;return i=!!i&&i.replace(/[\.]/g,""),/^-?\d+$/.test(i)&&!isNaN(Number(e))}function g(e,t){return String(e).padStart(t,"0")}this.input.value=""+function e(t){let i=0,n=t.map((e,n)=>{let l=o[i];return i=(i+1)%o.length,n===t.length-1?e:e+l}).join("");return n}(y,o)}val(e){var t;let i=this.options,n=i.blocks,l=this.input.value,r=i.contained,s=("NUMERAL"===i.type?[i.delimiters[0]]:i.delimiters).map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"));return e?l:r&&n?l.replace(RegExp(s.join("|"),"gi"),"").slice(0,(t=i.blocks,t.reduce((e,t)=>e+t,0))):l.replace(RegExp(s.join("|"),"gi"),"")}adjustValue(){let e="",t=this.options,i=this.input.value,n=t.delimiters,l=t.onlyNumbers,r="NUMERAL"===t.type,s=this.input.selectionStart,a=r?[n[0]].map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")):n.map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"));if(i=i.replace(RegExp(a.join("|"),"gi"),""),r){var o,u,p,h;e+=i.split("-").length>1?"-":"";let c,d=(o=i,u=n[1],c=RegExp(p?`\\${u}`:`(\\${u}(?=[^${u}]*\\${u}))`,"g"),(p?o.replace(c,function(e,t,i){return i.indexOf(e)===t?e:""}):o.replace(c,"")).replace(RegExp(`[^\\d${u}]`,"g"),"")).split(n[1]);d[0]=d[0].length>0?String((h=d[0],h.toLocaleString("fullwide",{useGrouping:!1}))):"",d[1]=d.length>1?n[1]+d[1]:"",i=d.join("")}i=l?i.replace(/[\D]/g,""):i,this.input.value=e+i,this.input.setSelectionRange(s,s)}destroy(){this.input.value=this.val(),this.input.removeEventListener("input",this.handleInputEventListener),this.input.removeEventListener("focus",this.handleFocusEventListener),this.input.removeEventListener("blur",this.handleBlurEventListener)}groups(){let e=this.options.delimiters,t=[this.val(!0)];return e.forEach(e=>{t=t.flatMap(t=>t.split(e))}),t=t.filter(e=>""!==e)}}
